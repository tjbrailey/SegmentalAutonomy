---
title: "tjbrailey_data_analysis"
subtitle: "POLI 191A/B"
author: "Thomas Brailey"
date: "29/09/2019"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(ggplot2)
```

# Load Data
```{r}
# Load PSP data, created in tjbrailey_wrangle_data.Rmd.
psp <- rio::import(paste0(here::here(), "/data/tjbrailey_psp_clean.csv"))
psp <- psp[,-1]
variable.names(psp)

psp$country <- as.factor(psp$country)
```

# Averages 
```{r}
wvs_avg <- psp %>%
  dplyr::group_by(country) %>%
  dplyr::filter(any(!is.na(wvs_factor))) %>%
  dplyr::summarize(avg = mean(wvs_factor, na.rm = TRUE))

seg_aut_yr <- psp %>%
  dplyr::group_by(country) %>%
  dplyr::filter(any(!is.na(wvs_factor))) %>%
  dplyr::tally(idc_auton == 1) %>%
  dplyr::mutate(n = (n / ((max(psp$year) - min(psp$year)) + 1) * 100 ))

wvs_seg_aut <- dplyr::left_join(seg_aut_yr, wvs_avg)

plot1 <- ggplot(wvs_seg_aut, aes(x = n, y = avg)) +
  geom_point() + 
  geom_smooth()
plot1
```

# Linear Regression on factored wvs values
```{r}
wvs_lm1 <- lm(wvs_factor ~ idc_auton, data = psp)
wvs_lm2 <- lm(wvs_factor ~ idc_auton + as.factor(year), data = psp)
wvs_lm3 <- lm(wvs_factor ~ idc_auton + as.factor(year) + as.factor(country), data = psp)
wvs_lm4 <- lm(wvs_factor ~ idc_auton + as.factor(year) + as.factor(country) + qog_gle_gdp, data = psp)
wvs_lm5 <- lm(wvs_factor ~ idc_auton + as.factor(year) + as.factor(country) + qog_gle_gdp + qog_wbgi_pve, data = psp)
wvs_lm6 <- lm(wvs_factor ~ (idc_auton * other_provis) + as.factor(year) + as.factor(country) + qog_gle_gdp + qog_wbgi_pve, data = psp)

summary(wvs_lm1)
summary(wvs_lm2)
summary(wvs_lm3)
summary(wvs_lm4)
summary(wvs_lm5)
summary(wvs_lm6)
```

# Linear Regression on conflict intensity
```{r}
con_lm1 <- lm(ucdp_cumulative_intensity ~ idc_auton, data = psp)
con_lm2 <- lm(ucdp_cumulative_intensity ~ idc_auton + year, data = psp)
con_lm3 <- lm(ucdp_cumulative_intensity ~ idc_auton + as.factor(year) + as.factor(country), data = psp)
con_lm4 <- lm(ucdp_cumulative_intensity ~ idc_auton + as.factor(year) + as.factor(country) + qog_gle_gdp, data = psp)
con_lm5 <- lm(ucdp_cumulative_intensity ~ idc_auton + as.factor(year) + as.factor(country) + qog_gle_gdp + qog_wbgi_pve, data = psp)
con_lm6 <- lm(ucdp_cumulative_intensity ~ (idc_auton * other_provis) + as.factor(year) + as.factor(country) + qog_gle_gdp + qog_wbgi_pve, data = psp)
summary(con_lm1)
summary(con_lm2)
summary(con_lm3)
summary(con_lm4)
summary(con_lm5)
summary(con_lm6)
```

# Logit 
```{r}
logit1 <- glm(ucdp_cumulative_intensity ~ idc_auton + year + as.factor(country),
                  data = psp, 
                family = binomial(link = "logit"))
Zelig::summary(logit1)
```


# Cox Regression
```{r}
cx1 <- survival::coxph(formula = survival::Surv(year, ucdp_cumulative_intensity) ~ idc_auton + country, data = psp)
summary(cx1)
```