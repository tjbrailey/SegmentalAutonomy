---
title: "03 Data Analysis"
author: "Thomas J. Brailey"
date: "29/09/2019"
output:
  html_notebook:
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
  html_document:
    toc: yes
editor_options:
  chunk_output_type: inline
---
<style>
    body .main-container {
        max-width: 100%;
    }
</style>

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(ggplot2)
```

# Load Data
```{r}
# Load PSP data, created in tjbrailey_wrangle_data.Rmd.
psp <- rio::import(paste0(here::here(), "/data/tjbrailey_psp_clean.csv"))
psp <- psp[,-1]
variable.names(psp)
#DataExplorer::plot_histogram(psp)

# Load esssential scripts
source(paste0(here::here(), "/R/csts.R"))
source(paste0(here::here(), "/R/lm.R"))
```

# Cross-Sectional Analyses
## UCDP Conflict
```{r}
csts("ucdp_cumulative_intensity", "tb_aut")
```

## QOG Support for Democracy
```{r}
csts("qog_hum_trust", "tb_aut")

csts("qog_hum_supdem", "tb_aut")

csts("qog_hum_satdem", "tb_aut")
```

## Polity Scores
```{r}
csts("polity4_polity_score", "tb_aut")
```









# Linear Regression QOG Democracy Information
```{r}
psp_lm("qog_hum_trust", "tb_aut")
psp_lm("qog_hum_supdem", "tb_aut")
psp_lm("qog_hum_satdem", "tb_aut")
```

```{r}
psp_lm("qog_hum_trust", "idc_auton")
psp_lm("qog_hum_supdem", "idc_auton")
psp_lm("qog_hum_satdem", "idc_auton")
```

# Linear Regression on Conflict Intensity
```{r}
psp_lm("ucdp_cumulative_intensity", "tb_aut")
psp_lm("ucdp_intensity_level", "tb_aut")
```

```{r}
psp_lm("ucdp_cumulative_intensity", "idc_auton")
psp_lm("ucdp_intensity_level", "idc_auton")
```

# Linear Regression on Polity Scores
```{r}
psp_lm("polity4_polity_score", "tb_aut")
psp_lm("polity4_polity_score", "idc_auton")
```
```{r}
# Bivariate
cox1 <- survival::coxph(survival::Surv(year, ucdp_cumulative_intensity) ~ idc_auton, data = psp)
summary(cox1)

# With controls
cox2 <- survival::coxph(survival::Surv(year, ucdp_cumulative_intensity) ~ (idc_auton * tb_other_provis) + as.factor(country) + qog_wbgi_pve + qog_wdi_gini + qog_gle_pop + polity4_polity_score, data = psp)
print(summary(cox2))
```